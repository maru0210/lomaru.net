---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import { highlightBody } from "../libs/highlight";
import { getBlogDetail, getBlogs } from "../libs/microcms";
import "../styles/blog.css";
import "highlight.js/styles/atom-one-dark.min.css";

export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id", "slug"] });
  return response.contents.map((content) => ({
    params: {
      slug: content.slug,
    },
    props: {
      id: content.id,
    },
  }));
}

const { id } = Astro.props;
const content = await getBlogDetail(id);
const post = {
  title: content.title,
  eyecatch_url: content.eyecatch?.url,
  body: highlightBody(content.body),
  date: new Date(content.publishedAt ?? 0).toLocaleDateString(),
};
---

<Layout>
  <div class="mx-auto max-w-screen-md px-8">
    <div class="tracking-wide">
      <div class="space-y-4 pb-16">
        <div class="text-right font-semibold text-neutral-500">
          {post.date}
        </div>
        <div class="text-3xl font-semibold">{post.title}</div>
        <Image
          src={post.eyecatch_url}
          alt="Eyecatch"
          class="rounded-xl shadow-lg"
          width={1920}
          height={1080}
        />
      </div>

      <article set:html={post.body} class="leading-relaxed" />
    </div>
  </div>
</Layout>
